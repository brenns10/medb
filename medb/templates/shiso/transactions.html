{% extends "layout.html" %}
{% block title %}{{ account.name }} - Account Overview - Shiso{% endblock %}
{% block content %}
<h1>{{ account.name }} - Account Overview</h1>
{% if account.sync_start %}
<p>Last synced {{account.sync_start}}</p>
{% else %}
<p>Not yet synced!</p>
{% endif %}
<form method="POST" action="{{url_for('.account_sync', account_id=account.id)}}" >
  {{ form.csrf_token }}
  {% if not account.sync_start %}
    <div class="form-group">
    {{ form.start_date.label }}
    {{ form.start_date(class_="form-control") }}
    </div>
  {% endif %}
  <div class="form-group">
    <button class="btn btn-md btn-primary" type="submit">Start Sync</button>
    {% if account.sync_start and next_unreviewed %}
    <a class="btn btn-md btn-info"
       href="{{ url_for('.account_review', account_id=account.id) }}">
      Review Transactions
    </a>
    {% endif %}
    <a class="btn btn-md btn-warning"
       href="{{ url_for('.account_report', account_id=account.id) }}">
      Report
    </a>
    <a class="btn btn-md btn-danger"
       href="{{ url_for('.account_rename', account_id=account.id) }}">
      Rename
    </a>
  </div>
</form>
<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th scope="col"></th>
      <th scope="col">Date</th>
      <th scope="col">Name</th>
      <th scope="col">Category</th>
      <th class="text-right" scope="col">Amount</th>
      <th class="text-right" scope="col">Reimburse</th>
    </tr>
  </thead>
  <tbody>
    {% for txn in txns %}
      <tr>
        <td>
          {% if txn.needs_review %}<span class="fa fa-edit fa-md main-list-item-icon"></span>{% endif %}
          {% if not txn.posted %}<span class="fa fa-hourglass-half fa-md main-list-item-icon"></span>{% endif %}
        </td>
        <td><a href="{{url_for('.review_transaction', txn_id=txn.id)}}">{{txn.date}}</a></td>
        <td>{{txn.name}}</td>
        <td>{{txn.review.category if txn.review else "" }}</td>
        <td class="text-right">{{'$%.2f' | format(txn.amount)}}</td>
        <td class="text-right">{{'$%.2f' | format(txn.review.reimbursement_amount if txn.review else 0)}}</td>
      </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
{% block footer %}{% endblock %}
